# Excel 导出功能使用说明

## 📊 功能概述

系统现已支持将考勤统计报表导出为 Excel 文件，方便进行数据分析和存档。

---

## 🚀 使用方法

### 1. 进入统计报表页面

1. 打开系统管理面板
2. 点击 **"统计报表"** 标签

### 2. 设置统计周期

- **选择月份**：使用月份选择器选择要统计的月份（例如：2025-12）
- 系统会自动根据月份计算统计日期范围

### 3. 生成并导出报表

1. **生成报表**：点击 **"生成报表"** 按钮，在页面上预览统计数据
2. **导出 Excel**：点击 **"导出Excel"** 按钮
3. **选择保存位置**：在弹出的文件保存对话框中选择保存位置
4. **命名文件**：系统会自动生成文件名（格式：`考勤报表_2025-12.xlsx`），你可以修改
5. **保存**：点击保存按钮，系统会显示"Excel 导出成功！"

---

## 📄 Excel 文件内容

导出的 Excel 文件包含两个工作表：

### 工作表1：考勤统计

包含所有员工的详细考勤数据：

| 列名 | 说明 |
|------|------|
| **序号** | 员工编号 |
| **姓名** | 员工姓名 |
| **出勤天数** | 实际出勤的天数 |
| **准时次数** | 准时打卡的次数 |
| **迟到次数** | 迟到的次数 |
| **早退次数** | 早退的次数 |
| **旷工次数** | 旷工的次数 |
| **总工作时长** | 累计工作时间 |

### 工作表2：报表概要

包含报表的汇总信息：

- 统计月份
- 统计日期范围
- 统计人数
- 总出勤天数
- 总迟到次数
- 导出时间

---

## 📋 示例数据

**考勤统计表**：
```
序号  姓名    出勤天数  准时次数  迟到次数  早退次数  旷工次数  总工作时长
1     管理员   0        0        0        0        0        0小时0分钟
2     测试打卡1 0        0        0        0        0        0小时0分钟
```

**报表概要**：
```
项目          内容
统计月份      2025-12
统计日期      2025-12-22 至 2025-12-22
统计人数      2 人
总出勤天数    0 天
总迟到次数    0 次
导出时间      2025/12/22 18:30:45
```

---

## 💡 使用技巧

### 1. 批量导出

如果需要导出多个月份的报表：
1. 依次选择不同月份
2. 分别导出为不同的 Excel 文件
3. 文件名会自动包含月份信息，避免混淆

### 2. 数据分析

导出后可以在 Excel 中：
- 使用筛选和排序功能
- 创建图表和透视表
- 进行更复杂的数据分析
- 打印或分享给其他人

### 3. 存档管理

建议的文件管理方式：
```
考勤报表/
  ├── 2025/
  │   ├── 考勤报表_2025-01.xlsx
  │   ├── 考勤报表_2025-02.xlsx
  │   └── 考勤报表_2025-12.xlsx
  └── 2026/
      └── ...
```

---

## 🔧 技术实现

### 使用的技术栈

- **xlsx (SheetJS)**: Excel 文件生成库
- **Tauri Dialog API**: 原生文件保存对话框
- **Tauri FS API**: 文件系统写入

### 数据流程

```
1. 用户点击"导出Excel"
   ↓
2. 前端生成报表数据
   ↓
3. 使用 xlsx 库创建 Excel 工作簿
   - 添加考勤统计表
   - 添加报表概要表
   - 设置列宽和格式
   ↓
4. 转换为二进制数据
   ↓
5. 调用 Tauri 保存对话框
   ↓
6. 用户选择保存位置
   ↓
7. 写入文件到磁盘
   ↓
8. 显示成功提示
```

### 权限配置

系统已配置以下权限（在 `tauri.conf.json` 中）：

```json
{
  "dialog": {
    "save": true
  },
  "fs": {
    "writeBinaryFile": true,
    "scope": ["$DOWNLOAD/*", "$DOCUMENT/*", "$DESKTOP/*", "$HOME/*"]
  }
}
```

这允许应用在以下位置保存文件：
- 下载文件夹
- 文档文件夹
- 桌面
- 用户主目录

---

## ⚠️ 注意事项

### 数据准确性

- Excel 数据与页面预览数据完全一致
- 导出时会包含当前筛选条件下的所有用户
- 确保在导出前检查统计周期设置

### 文件权限

- 确保选择的保存位置有写入权限
- 如果保存失败，尝试选择其他位置（如桌面）
- Windows 用户注意：某些系统文件夹可能需要管理员权限

### 浏览器兼容性

- 此功能在 Tauri 桌面应用中可用
- 不适用于网页版（如果有的话）

---

## 🐛 常见问题

### Q: 导出按钮点击后没反应？

**A**: 检查以下几点：
1. 是否已经生成报表数据
2. 浏览器控制台是否有错误信息
3. 尝试重新加载应用

### Q: 提示"Excel 导出失败"？

**A**: 可能的原因：
1. 选择的保存位置没有写入权限
2. 磁盘空间不足
3. 文件名包含非法字符
4. 尝试保存到其他位置（如桌面）

### Q: Excel 文件打不开？

**A**: 
1. 确保使用 Microsoft Excel 或 WPS 等兼容软件
2. 检查文件扩展名是否为 `.xlsx`
3. 尝试重新导出

### Q: 数据显示为 0？

**A**: 
1. 检查统计日期范围内是否有打卡记录
2. 确认筛选条件是否正确
3. 某些统计项（如工作时长）可能还在开发中

---

## 📞 技术支持

如遇到其他问题：
1. 检查系统版本是否为最新
2. 查看应用日志（开发者工具 → Console）
3. 联系系统管理员

---

## 🎯 未来改进计划

- [ ] 支持自定义导出字段
- [ ] 支持导出为 PDF 格式
- [ ] 支持批量导出多个月份
- [ ] 添加图表和可视化
- [ ] 支持导出模板自定义

---

**版本**: v1.1.0  
**更新日期**: 2025年12月22日
